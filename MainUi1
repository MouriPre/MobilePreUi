local UILibrary = {}
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")

function UILibrary.new(title)
    -- Remove existing GUI
    local existingGUI = game:GetService("CoreGui"):FindFirstChild(title)
    if existingGUI then
        existingGUI:Destroy()
    end

    -- Create new ScreenGUI
    local ScreenGUI = Instance.new("ScreenGui")
    ScreenGUI.Name = title
    ScreenGUI.Parent = game:GetService("CoreGui")
    ScreenGUI.ResetOnSpawn = false

    -- Main Frame
    local MainFrame = Instance.new("Frame")
    MainFrame.Name = "MainFrame"
    MainFrame.Size = UDim2.new(0, 400, 0, 300)
    MainFrame.Position = UDim2.new(0.5, -200, 0.5, -150)
    MainFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
    MainFrame.BorderSizePixel = 0
    MainFrame.Active = true
    MainFrame.Draggable = true
    MainFrame.Parent = ScreenGUI
    MainFrame.ClipsDescendants = true

    -- Background Image
    local Background = Instance.new("ImageLabel")
    Background.Name = "Background"
    Background.Size = UDim2.new(1, 0, 1, 0)
    Background.Position = UDim2.new(0, 0, 0, 0)
    Background.BackgroundTransparency = 1
    Background.Image = "rbxassetid://104809137040953"
    Background.ImageTransparency = 0.2
    Background.ScaleType = Enum.ScaleType.Stretch
    Background.Parent = MainFrame

    -- Add blur effect
    local Blur = Instance.new("BlurEffect")
    Blur.Size = 0
    Blur.Parent = game:GetService("Lighting")

    -- Top Bar
    local TopBar = Instance.new("Frame")
    TopBar.Name = "TopBar"
    TopBar.Size = UDim2.new(1, 0, 0, 35)
    TopBar.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
    TopBar.BackgroundTransparency = 0.3
    TopBar.BorderSizePixel = 0
    TopBar.Parent = MainFrame

    -- Title with shadow effect
    local TitleLabel = Instance.new("TextLabel")
    TitleLabel.Name = "Title"
    TitleLabel.Size = UDim2.new(1, -20, 1, 0)
    TitleLabel.Position = UDim2.new(0, 10, 0, 0)
    TitleLabel.BackgroundTransparency = 1
    TitleLabel.Text = title
    TitleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    TitleLabel.TextSize = 18
    TitleLabel.Font = Enum.Font.GothamBold
    TitleLabel.TextXAlignment = Enum.TextXAlignment.Left
    TitleLabel.Parent = TopBar

    -- Add text shadow
    local TitleShadow = TitleLabel:Clone()
    TitleShadow.Position = UDim2.new(0, 11, 0, 1)
    TitleShadow.TextColor3 = Color3.fromRGB(0, 0, 0)
    TitleShadow.TextTransparency = 0.8
    TitleShadow.ZIndex = 0
    TitleShadow.Parent = TopBar

    -- Add Corner Radius
    local UICorner = Instance.new("UICorner")
    UICorner.CornerRadius = UDim.new(0, 8)
    UICorner.Parent = MainFrame

    -- Make corners smooth for TopBar
    local TopBarCorner = Instance.new("UICorner")
    TopBarCorner.CornerRadius = UDim.new(0, 8)
    TopBarCorner.Parent = TopBar

    -- Add main frame shadow
    local Shadow = Instance.new("ImageLabel")
    Shadow.Name = "Shadow"
    Shadow.AnchorPoint = Vector2.new(0.5, 0.5)
    Shadow.BackgroundTransparency = 1
    Shadow.Position = UDim2.new(0.5, 0, 0.5, 0)
    Shadow.Size = UDim2.new(1, 47, 1, 47)
    Shadow.ZIndex = -1
    Shadow.Image = "rbxassetid://6015897843"
    Shadow.ImageColor3 = Color3.new(0, 0, 0)
    Shadow.ImageTransparency = 0.5
    Shadow.Parent = MainFrame

    -- Content Container
    local ContentContainer = Instance.new("Frame")
    ContentContainer.Name = "ContentContainer"
    ContentContainer.Size = UDim2.new(1, -20, 1, -45)
    ContentContainer.Position = UDim2.new(0, 10, 0, 40)
    ContentContainer.BackgroundTransparency = 1
    ContentContainer.Parent = MainFrame

    -- Animation functions
    local function showUI()
        MainFrame.Size = UDim2.new(0, 0, 0, 0)
        MainFrame.Position = UDim2.new(0.5, 0, 0.5, 0)
        MainFrame.BackgroundTransparency = 1
        Background.ImageTransparency = 1
        MainFrame.Visible = true
        TopBar.BackgroundTransparency = 1
        TitleLabel.TextTransparency = 1
        Shadow.ImageTransparency = 1

        local tweenInfo = TweenInfo.new(0.6, Enum.EasingStyle.Back, Enum.EasingDirection.Out)
        local sizeTween = TweenService:Create(MainFrame, tweenInfo, {
            Size = UDim2.new(0, 400, 0, 300),
            Position = UDim2.new(0.5, -200, 0.5, -150),
            BackgroundTransparency = 0
        })

        local backgroundTween = TweenService:Create(Background, TweenInfo.new(0.4, Enum.EasingStyle.Quart, Enum.EasingDirection.Out), {
            ImageTransparency = 0.2
        })

        local topBarTween = TweenService:Create(TopBar, TweenInfo.new(0.4, Enum.EasingStyle.Quart, Enum.EasingDirection.Out), {
            BackgroundTransparency = 0.3
        })

        local titleTween = TweenService:Create(TitleLabel, TweenInfo.new(0.4, Enum.EasingStyle.Quart, Enum.EasingDirection.Out), {
            TextTransparency = 0
        })

        local shadowTween = TweenService:Create(Shadow, TweenInfo.new(0.4, Enum.EasingStyle.Quart, Enum.EasingDirection.Out), {
            ImageTransparency = 0.5
        })

        local blurTween = TweenService:Create(Blur, TweenInfo.new(0.4), {Size = 10})

        sizeTween:Play()
        backgroundTween:Play()
        topBarTween:Play()
        titleTween:Play()
        shadowTween:Play()
        blurTween:Play()
    end

    local function hideUI()
        local tweenInfo = TweenInfo.new(0.6, Enum.EasingStyle.Back, Enum.EasingDirection.In)
        local sizeTween = TweenService:Create(MainFrame, tweenInfo, {
            Size = UDim2.new(0, 0, 0, 0),
            Position = UDim2.new(0.5, 0, 0.5, 0),
            BackgroundTransparency = 1
        })

        local backgroundTween = TweenService:Create(Background, TweenInfo.new(0.3, Enum.EasingStyle.Quart, Enum.EasingDirection.In), {
            ImageTransparency = 1
        })

        local topBarTween = TweenService:Create(TopBar, TweenInfo.new(0.3, Enum.EasingStyle.Quart, Enum.EasingDirection.In), {
            BackgroundTransparency = 1
        })

        local titleTween = TweenService:Create(TitleLabel, TweenInfo.new(0.3, Enum.EasingStyle.Quart, Enum.EasingDirection.In), {
            TextTransparency = 1
        })

        local shadowTween = TweenService:Create(Shadow, TweenInfo.new(0.3, Enum.EasingStyle.Quart, Enum.EasingDirection.In), {
            ImageTransparency = 1
        })

        local blurTween = TweenService:Create(Blur, TweenInfo.new(0.3), {Size = 0})

        sizeTween.Completed:Connect(function()
            MainFrame.Visible = false
        end)

        sizeTween:Play()
        backgroundTween:Play()
        topBarTween:Play()
        titleTween:Play()
        shadowTween:Play()
        blurTween:Play()
    end

    -- Toggle with RightShift key
    local isUIVisible = true
    local isAnimating = false

    UserInputService.InputBegan:Connect(function(input)
        if input.KeyCode == Enum.KeyCode.RightShift then
            if isAnimating then return end
            isAnimating = true
            
            isUIVisible = not isUIVisible
            if isUIVisible then
                showUI()
            else
                hideUI()
            end
            
            wait(0.6)
            isAnimating = false
        end
    end)

    MainFrame.Visible = true
    showUI()

    return ContentContainer
end

return UILibrary
